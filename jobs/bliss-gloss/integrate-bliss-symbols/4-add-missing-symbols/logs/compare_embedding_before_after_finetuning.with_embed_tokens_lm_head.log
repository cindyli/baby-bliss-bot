Defaulting to user installation because normal site-packages is not writeable
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v4, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Requirement already satisfied: pip in /home/cindyli/.local/lib/python3.9/site-packages (25.2+computecanada)
created virtual environment CPython3.13.2.final.0-64 in 11685ms
  creator CPython3Posix(dest=/localscratch/cindyli.5170060.0/env, clear=False, no_vcs_ignore=False, global=False)
  seeder FromAppData(download=False, pip=bundle, via=copy, app_data_dir=/home/cindyli/.local/share/virtualenv)
    added seed packages: pip==25.2
  activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v4, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Requirement already satisfied: pip in /localscratch/cindyli.5170060.0/env/lib/python3.13/site-packages (25.2)
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/pip-25.2+computecanada-py3-none-any.whl
Installing collected packages: pip
  Attempting uninstall: pip
    Found existing installation: pip 25.2
    Uninstalling pip-25.2:
      Successfully uninstalled pip-25.2
Successfully installed pip-25.2+computecanada

Due to MODULEPATH changes, the following have been reloaded:
  1) aocl-blas/5.1     2) aocl-lapack/5.1

The following have been reloaded with a version change:
  1) flexiblas/3.3.1 => flexiblas/3.4.4       6) openmpi/4.1.5 => openmpi/5.0.3
  2) gcc/12.3 => gcc/13.3                     7) pmix/4.2.4 => pmix/5.0.2
  3) gcccore/.12.3 => gcccore/.13.3           8) ucc/1.2.0 => ucc/1.3.0
  4) hwloc/2.9.1 => hwloc/2.10.0              9) ucx/1.14.1 => ucx/1.16.0
  5) libfabric/1.18.0 => libfabric/1.21.0

Defaulting to user installation because normal site-packages is not writeable
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v4, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/x86-64-v3, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo2023/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Requirement already satisfied: torch==2.6.0 in /home/cindyli/.local/lib/python3.13/site-packages (2.6.0+computecanada)
Requirement already satisfied: transformers==4.50.3 in /home/cindyli/.local/lib/python3.13/site-packages (4.50.3)
Requirement already satisfied: huggingface_hub==0.30.2 in /home/cindyli/.local/lib/python3.13/site-packages (0.30.2+computecanada)
Requirement already satisfied: pandas in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v4/Compiler/gcccore/scipy-stack/2025a/lib/python3.13/site-packages (2.2.3+computecanada)
Requirement already satisfied: filelock in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v4/Compiler/gcccore/python/3.13.2/lib/python3.13/site-packages (from torch==2.6.0) (3.17.0)
Requirement already satisfied: typing-extensions>=4.10.0 in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v4/Compiler/gcccore/python/3.13.2/lib/python3.13/site-packages (from torch==2.6.0) (4.12.2)
Requirement already satisfied: setuptools in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v4/Compiler/gcccore/python/3.13.2/lib/python3.13/site-packages (from torch==2.6.0) (75.8.0)
Requirement already satisfied: sympy==1.13.1 in /home/cindyli/.local/lib/python3.13/site-packages (from torch==2.6.0) (1.13.1+computecanada)
Requirement already satisfied: networkx in /home/cindyli/.local/lib/python3.13/site-packages (from torch==2.6.0) (3.4.2+computecanada)
Requirement already satisfied: jinja2 in /home/cindyli/.local/lib/python3.13/site-packages (from torch==2.6.0) (3.1.6+computecanada)
Requirement already satisfied: fsspec in /home/cindyli/.local/lib/python3.13/site-packages (from torch==2.6.0) (2024.12.0+computecanada)
Requirement already satisfied: numpy>=1.17 in /home/cindyli/.local/lib/python3.13/site-packages (from transformers==4.50.3) (2.2.2+computecanada)
Requirement already satisfied: packaging>=20.0 in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v4/Compiler/gcccore/python/3.13.2/lib/python3.13/site-packages (from transformers==4.50.3) (24.2)
Requirement already satisfied: pyyaml>=5.1 in /home/cindyli/.local/lib/python3.13/site-packages (from transformers==4.50.3) (6.0.2+computecanada)
Requirement already satisfied: regex!=2019.12.17 in /home/cindyli/.local/lib/python3.13/site-packages (from transformers==4.50.3) (2024.11.6+computecanada)
Requirement already satisfied: requests in /home/cindyli/.local/lib/python3.13/site-packages (from transformers==4.50.3) (2.32.3+computecanada)
Requirement already satisfied: tokenizers<0.22,>=0.21 in /home/cindyli/.local/lib/python3.13/site-packages (from transformers==4.50.3) (0.21.0+computecanada)
Requirement already satisfied: safetensors>=0.4.3 in /home/cindyli/.local/lib/python3.13/site-packages (from transformers==4.50.3) (0.4.5+computecanada)
Requirement already satisfied: tqdm>=4.27 in /home/cindyli/.local/lib/python3.13/site-packages (from transformers==4.50.3) (4.67.1+computecanada)
Requirement already satisfied: mpmath<1.4,>=1.1.0 in /home/cindyli/.local/lib/python3.13/site-packages (from sympy==1.13.1->torch==2.6.0) (1.3.0+computecanada)
Requirement already satisfied: python-dateutil>=2.8.2 in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v4/Compiler/gcccore/scipy-stack/2025a/lib/python3.13/site-packages (from pandas) (2.9.0.post0+computecanada)
Requirement already satisfied: pytz>=2020.1 in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v4/Compiler/gcccore/scipy-stack/2025a/lib/python3.13/site-packages (from pandas) (2025.1+computecanada)
Requirement already satisfied: tzdata>=2022.7 in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v4/Compiler/gcccore/scipy-stack/2025a/lib/python3.13/site-packages (from pandas) (2025.1+computecanada)
Requirement already satisfied: six>=1.5 in /cvmfs/soft.computecanada.ca/easybuild/software/2023/x86-64-v4/Compiler/gcccore/scipy-stack/2025a/lib/python3.13/site-packages (from python-dateutil>=2.8.2->pandas) (1.17.0+computecanada)
Requirement already satisfied: MarkupSafe>=2.0 in /home/cindyli/.local/lib/python3.13/site-packages (from jinja2->torch==2.6.0) (3.0.2+computecanada)
Requirement already satisfied: charset-normalizer<4,>=2 in /home/cindyli/.local/lib/python3.13/site-packages (from requests->transformers==4.50.3) (3.4.1+computecanada)
Requirement already satisfied: idna<4,>=2.5 in /home/cindyli/.local/lib/python3.13/site-packages (from requests->transformers==4.50.3) (3.10+computecanada)
Requirement already satisfied: urllib3<3,>=1.21.1 in /home/cindyli/.local/lib/python3.13/site-packages (from requests->transformers==4.50.3) (2.3.0+computecanada)
Requirement already satisfied: certifi>=2017.4.17 in /home/cindyli/.local/lib/python3.13/site-packages (from requests->transformers==4.50.3) (2025.1.31+computecanada)
Package            Version
------------------ -------------------------
accelerate         1.5.2+computecanada
aiohappyeyeballs   2.6.1+computecanada
aiohttp            3.11.14+computecanada
aiosignal          1.3.2+computecanada
asttokens          3.0.0+computecanada
attrs              25.3.0+computecanada
bitsandbytes       0.45.2+computecanada
certifi            2025.1.31+computecanada
charset_normalizer 3.4.1+computecanada
comm               0.2.2+computecanada
contourpy          1.3.1+computecanada
cycler             0.12.1+computecanada
datasets           3.5.0
debugpy            1.8.12+computecanada
decorator          5.1.1+computecanada
dill               0.3.8+computecanada
distlib            0.3.9
executing          2.2.0+computecanada
filelock           3.17.0
flit_core          3.10.1
fonttools          4.55.8+computecanada
frozenlist         1.5.0+computecanada
fsspec             2024.12.0+computecanada
hatch-vcs          0.4.0
hatchling          1.27.0
huggingface_hub    0.30.2+computecanada
idna               3.10+computecanada
ipykernel          6.29.5+computecanada
ipython            8.32.0+computecanada
ipywidgets         8.1.5+computecanada
jedi               0.19.2+computecanada
jinja2             3.1.6+computecanada
jupyter_client     8.6.3+computecanada
jupyter_core       5.7.2+computecanada
jupyterlab_widgets 3.0.13+computecanada
kiwisolver         1.4.8+computecanada
MarkupSafe         3.0.2+computecanada
matplotlib         3.10.0+computecanada
matplotlib_inline  0.1.7+computecanada
mpmath             1.3.0+computecanada
multidict          6.2.0+computecanada
multiprocess       0.70.16+computecanada
nest_asyncio       1.6.0+computecanada
networkx           3.4.2+computecanada
numpy              2.2.2+computecanada
packaging          24.2
pandas             2.2.3+computecanada
parso              0.8.4+computecanada
pathspec           0.12.1
peft               0.15.1
pexpect            4.9.0+computecanada
pillow             11.1.0+computecanada
pip                25.0
platformdirs       4.3.6
pluggy             1.5.0
prompt_toolkit     3.0.50+computecanada
propcache          0.3.1+computecanada
psutil             6.1.1+computecanada
ptyprocess         0.7.0+computecanada
pure_eval          0.2.3+computecanada
pyarrow            19.0.1
pygments           2.19.1+computecanada
pyparsing          3.2.1+computecanada
python_dateutil    2.9.0.post0+computecanada
pytz               2025.1+computecanada
PyYAML             6.0.2+computecanada
pyzmq              26.2.1+computecanada
regex              2024.11.6+computecanada
requests           2.32.3+computecanada
safetensors        0.4.5+computecanada
scipy              1.15.1+computecanada
setuptools         75.8.0
setuptools-scm     8.1.0
six                1.17.0+computecanada
stack_data         0.6.3+computecanada
sympy              1.13.1+computecanada
tokenizers         0.21.0+computecanada
tomli              2.2.1
torch              2.6.0+computecanada
tornado            6.4.2+computecanada
tqdm               4.67.1+computecanada
traitlets          5.14.3+computecanada
transformers       4.50.3
trove-classifiers  2025.1.15.22
typing_extensions  4.12.2
tzdata             2025.1+computecanada
urllib3            2.3.0+computecanada
virtualenv         20.29.1
wcwidth            0.2.13+computecanada
wheel              0.45.1
widgetsnbextension 4.0.13+computecanada
xxhash             3.5.0
yarl               1.18.3+computecanada
=== Compare input embeddings before and after the fine-tuning with job ID 5170060 on nodes fc10510.
Loading original model...
Loading checkpoint shards:   0%|          | 0/7 [00:00<?, ?it/s]Loading checkpoint shards:  14%|█▍        | 1/7 [00:47<04:44, 47.38s/it]Loading checkpoint shards:  29%|██▊       | 2/7 [01:50<04:43, 56.67s/it]Loading checkpoint shards:  43%|████▎     | 3/7 [03:01<04:12, 63.24s/it]Loading checkpoint shards:  57%|█████▋    | 4/7 [04:16<03:23, 67.74s/it]Loading checkpoint shards:  71%|███████▏  | 5/7 [05:26<02:17, 68.60s/it]Loading checkpoint shards:  86%|████████▌ | 6/7 [06:40<01:10, 70.44s/it]Loading checkpoint shards: 100%|██████████| 7/7 [06:57<00:00, 53.13s/it]Loading checkpoint shards: 100%|██████████| 7/7 [06:57<00:00, 59.70s/it]
Embeddings shape before fine-tuning: torch.Size([130626, 4096])
Loading fine-tuned model...
Loading checkpoint shards:   0%|          | 0/7 [00:00<?, ?it/s]Loading checkpoint shards:  14%|█▍        | 1/7 [00:48<04:49, 48.21s/it]Loading checkpoint shards:  29%|██▊       | 2/7 [01:52<04:48, 57.73s/it]Loading checkpoint shards:  43%|████▎     | 3/7 [02:58<04:05, 61.30s/it]Loading checkpoint shards:  57%|█████▋    | 4/7 [04:10<03:16, 65.58s/it]Loading checkpoint shards:  71%|███████▏  | 5/7 [05:09<02:06, 63.27s/it]Loading checkpoint shards:  86%|████████▌ | 6/7 [06:14<01:03, 63.71s/it]Loading checkpoint shards: 100%|██████████| 7/7 [06:31<00:00, 48.59s/it]Loading checkpoint shards: 100%|██████████| 7/7 [06:31<00:00, 55.93s/it]
Embeddings shape after fine-tuning: torch.Size([130627, 4096])
Calculating changes for all tokens...

Input Embedding - Top 20 tokens with largest Euclidean distance change:
        token_id          token  input_embedding_cosine_similarity  input_embedding_euclidean_distance  output_embedding_cosine_similarity  output_embedding_euclidean_distance
6612        6612           felt                             0.1533                              3.7969                              0.9961                               0.0635
128768    128768  [BLISS_14927]                             0.1318                              3.6719                              0.9961                               0.0664
9615        9615          truly                             0.1631                              3.5781                              0.9961                               0.0325
5149        5149         effort                             0.1592                              3.5781                              0.9961                               0.0300
129953    129953  [BLISS_24294]                             0.1279                              3.5469                              1.0000                               0.0262
11937      11937        herself                             0.1719                              3.5312                              1.0000                               0.0178
11944      11944       detailed                             0.1943                              3.5156                              0.9961                               0.0437
2170        2170             As                             0.1270                              3.4844                              1.0000                               0.0173
31518      31518         enrich                             0.2002                              3.4844                              1.0000                               0.0234
129258    129258  [BLISS_18228]                             0.1768                              3.4531                              1.0000                               0.0496
47964      47964    intentional                             0.2402                              3.4062                              0.9922                               0.0635
1781        1781          think                             0.1846                              3.4062                              1.0078                               0.0254
63081      63081    friendships                             0.2207                              3.3750                              0.9961                               0.0884
1109        1109           than                             0.1729                              3.3594                              0.9961                               0.0294
8040        8040      developed                             0.1758                              3.2969                              1.0000                               0.0297
1397        1397        require                             0.1787                              3.2656                              1.0000                               0.0396
1205        1205           need                             0.1426                              3.2344                              1.0000                               0.0356
1097        1097             am                             0.1680                              3.2344                              1.0000                               0.0234
129175    129175  [BLISS_17720]                             0.1299                              3.2031                              1.0000                               0.0425
2890        2890         health                             0.1875                              3.2031                              1.0000                               0.0393

Input Embedding - Top 20 tokens with lowest cosine similarity:
        token_id                      token  input_embedding_cosine_similarity  input_embedding_euclidean_distance  output_embedding_cosine_similarity  output_embedding_euclidean_distance
185          185                          �                             0.0000                              0.0000                              1.0000                               0.0189
179          179                          �                             0.0000                              0.0000                              1.0000                               0.0189
182          182                          �                             0.0000                              0.0000                              1.0000                               0.0189
103003    103003                      аракт                             0.0000                              0.0000                              1.0000                               0.0189
186          186                          �                             0.0000                              0.0000                              1.0000                               0.0189
125          125                          �                             0.0000                              0.0000                              1.0000                               0.0189
106710    106710                      атися                             0.0000                              0.0000                              1.0000                               0.0189
180          180                          �                             0.0000                              0.0000                              1.0000                               0.0189
187          187                          �                             0.0000                              0.0000                              1.0000                               0.0189
181          181                          �                             0.0000                              0.0000                              1.0000                               0.0189
178          178                          �                             0.0000                              0.0000                              1.0000                               0.0189
184          184                          �                             0.0000                              0.0000                              1.0000                               0.0189
128004    128004  <|finetune_right_pad_id|>                             0.0000                              0.0000                              1.0000                               0.0189
177          177                          �                             0.0000                              0.0000                              1.0000                               0.0189
183          183                          �                             0.0000                              0.0000                              1.0000                               0.0189
122746    122746                     илакти                             0.0000                              0.0000                              1.0000                               0.0189
100617    100617                         ۱�                             0.0000                              0.0000                              1.0000                               0.0189
124          124                          �                             0.0000                              0.0000                              1.0000                               0.0189
128009    128009                 <|eot_id|>                             0.0294                              2.8281                              0.9844                               0.0952
129168    129168              [BLISS_17697]                             0.1187                              2.9375                              1.0000                               0.0488

Output Embedding - Top 20 tokens with largest Euclidean distance change:
        token_id          token  input_embedding_cosine_similarity  input_embedding_euclidean_distance  output_embedding_cosine_similarity  output_embedding_euclidean_distance
1054        1054              “                             1.0078                              0.0000                              0.9883                               0.1426
128298    128298   [BLISS_8559]                             0.9961                              0.0000                              0.9883                               0.1416
3451        3451              ‘                             1.0000                              0.0000                              0.9844                               0.1416
129957    129957  [BLISS_24309]                             0.9961                              0.0000                              0.9883                               0.1406
330          330              "                             0.9961                              0.0000                              0.9883                               0.1387
128763    128763  [BLISS_14907]                             1.0000                              0.0000                              0.9883                               0.1377
128260    128260   [BLISS_8487]                             0.9961                              0.0000                              0.9922                               0.1377
1174        1174              ,                             0.9961                              0.0000                              0.9922                               0.1377
128881    128881  [BLISS_15702]                             0.9961                              0.0000                              0.9883                               0.1367
4194        4194                                            1.0000                              0.0000                              0.9922                               0.1348
320          320              (                             1.0000                              0.0000                              0.9922                               0.1348
3411        3411        looking                             1.0000                              0.0000                              0.9844                               0.1348
129823    129823  [BLISS_23906]                             1.0000                              0.0000                              0.9883                               0.1348
3794        3794        getting                             1.0000                              0.0000                              0.9844                               0.1338
128309    128309   [BLISS_8570]                             1.0000                              0.0000                              0.9922                               0.1338
350          350              T                             1.0000                              0.0000                              0.9922                               0.1338
353          353              *                             1.0000                              0.0000                              0.9883                               0.1328
6593        6593        medical                             1.0000                              0.0000                              0.9883                               0.1328
128290    128290   [BLISS_8551]                             1.0000                              0.0000                              0.9883                               0.1328
8              8              )                             1.0000                              0.0000                              0.9883                               0.1328

Output Embedding - Top 20 tokens with lowest cosine similarity:
        token_id          token  input_embedding_cosine_similarity  input_embedding_euclidean_distance  output_embedding_cosine_similarity  output_embedding_euclidean_distance
29275      29275           .)\n                             1.0000                              0.0000                              0.9727                               0.1035
4390        4390           ).\n                             0.9961                              0.0000                              0.9766                               0.1084
3677        3677         ).\n\n                             1.0078                              0.0000                              0.9766                               0.1030
7609        7609             ).                             1.0078                              0.0000                              0.9766                               0.1162
14924      14924       Question                             0.9961                              0.0000                              0.9766                               0.1006
35327      35327         varies                             0.9961                              0.0000                              0.9805                               0.1230
2684        2684          There                             0.9961                              0.0000                              0.9805                               0.1260
130625    130625  [BLISS_12356]                             1.0000                              0.0000                              0.9805                               0.1045
33517      33517          fifty                             0.9961                              0.0000                              0.9805                               0.1118
33452      33452   considerably                             1.0000                              0.0000                              0.9805                               0.1069
29089      29089          Would                             1.0000                              0.0000                              0.9805                               0.1201
12106      12106             )?                             1.0000                              0.0000                              0.9805                               0.1084
12522      12522           Have                             1.0078                              0.0000                              0.9805                               0.1167
335          335              }                             1.0000                              0.0000                              0.9805                               0.1060
340          340            )\n                             1.0000                              0.0000                              0.9805                               0.1060
5334        5334           gets                             1.0000                              0.0000                              0.9805                               0.1182
46728      46728     emphasized                             1.0078                              0.0000                              0.9805                               0.1157
1237        1237             );                             1.0000                              0.0000                              0.9805                               0.1045
56030      56030   acknowledges                             1.0000                              0.0000                              0.9805                               0.1138
9002        9002      regarding                             0.9961                              0.0000                              0.9805                               0.1309
